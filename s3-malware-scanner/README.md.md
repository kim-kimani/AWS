# üõ°Ô∏è S3 Malware Scanner using ClamAV and AWS Lambda

This project scans files uploaded to an S3 bucket for malware using ClamAV inside an AWS Lambda container.

---

## üì¶ Features

| Feature | Description |
| - | - |
| Automatically scans files uploaded to S3 | Yes |
| Quarantines infected files | Yes |
| Sends clean files to a clean bucket | Yes |
| Uses ClamAV with up-to-date definitions | Yes |
| Fully Dockerized Lambda function | Yes |
| Minimal configuration via `env.sh` | Yes |

---

## üß∞ Tech Stack

| Technology | Description |
| - | - |
| AWS S3 | Storage service |
| AWS Lambda (Container Image) | Serverless compute |
| Python 3.x | Programming language |
| ClamAV | Antivirus software |
| Docker | Containerization |
| Bash | Scripting |

---

## üìÅ Folder Structure

| Path | Description |
| - | - |
| `Dockerfile` | Defines Lambda container |
| `lambda_function.py` | Main Lambda handler |
| `env.sh` | Bucket configuration |
| `requirements.txt` | Python dependencies |
| `README.md` | Project documentation |
| `.gitignore` | Git ignore file |

---

## üöÄ Setup Instructions

### 1. Clone the Repo

```bash
git clone https://github.com/kim-kimani/s3-malware-scanner.git
cd s3-malware-scanner
```

### 2. Configure Bucket Names

Edit `env.sh` and set your custom bucket names:

```bash
export INCOMING_BUCKET=incoming-bucket
export CLEAN_BUCKET=clean-bucket
export QUARANTINE_BUCKET=quarantine-bucket
```

Then apply it:

```bash
source env.sh
```

### 3. Build and Push Docker Image

```bash
docker build -t s3-malware-scanner .
docker tag s3-malware-scanner:latest <your-ecr-uri>/s3-malware-scanner:latest
docker push <your-ecr-uri>/s3-malware-scanner:latest
```

Example:

```bash
docker tag s3-malware-scanner:latest 630413101525.dkr.ecr.us-east-1.amazonaws.com/s3-malware-scanner:latest
docker push 630413101525.dkr.ecr.us-east-1.amazonaws.com/s3-malware-scanner:latest
```

### 4. Create Buckets

```bash
aws s3 mb s3://incoming-bucket
aws s3 mb s3://clean-bucket
aws s3 mb s3://quarantine-bucket
```

### 5. Deploy Lambda

You can create a new Lambda function or update an existing one using:

```bash
aws lambda update-function-code \
  --function-name s3-malware-scanner \
  --image-uri 630413101525.dkr.ecr.us-east-1.amazonaws.com/s3-malware-scanner:latest
```

### 6. Add S3 Trigger

1. Go to AWS Console > Lambda > Triggers
2. Add a trigger for `incoming-bucket`
3. Event type: PUT

---

## üß™ Testing

1. Upload a file to `incoming-bucket`
2. Watch logs with:

```bash
aws logs tail /aws/lambda/s3-malware-scanner --follow
```

- Clean files go to `clean-bucket`
- Infected files go to `quarantine-bucket`

---

## üìã TODO (Optional Features)

| Feature | Description |
| - | - |
| Email alerts on detection | Send email notifications when malware is detected |
| Slack/Discord integration | Send notifications to Slack or Discord |
| Add file metadata logging | Log metadata of scanned files |
| Add tests and CI | Implement testing and continuous integration |